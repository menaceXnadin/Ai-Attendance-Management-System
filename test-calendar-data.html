<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calendar Data Test</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background: #1a1a1a; color: white; }
        .result { background: #2a2a2a; padding: 15px; margin: 10px 0; border-radius: 8px; }
        .error { background: #4a1a1a; border: 1px solid #ff4444; }
        .success { background: #1a4a1a; border: 1px solid #44ff44; }
        pre { background: #0a0a0a; padding: 10px; border-radius: 4px; overflow-x: auto; }
    </style>
</head>
<body>
    <h1>🔍 Academic Calendar Data Test</h1>
    <p>Testing if frontend can reach backend API and what data is returned...</p>
    
    <div id="results"></div>
    
    <script>
        async function testCalendarAPI() {
            const resultsDiv = document.getElementById('results');
            
            // Test 1: Check if backend is running
            try {
                resultsDiv.innerHTML += '<div class="result">📡 Testing backend connection...</div>';
                
                const healthResponse = await fetch('http://localhost:8000/health');
                if (healthResponse.ok) {
                    resultsDiv.innerHTML += '<div class="result success">✅ Backend is running!</div>';
                } else {
                    resultsDiv.innerHTML += '<div class="result error">❌ Backend health check failed</div>';
                    return;
                }
            } catch (error) {
                resultsDiv.innerHTML += `<div class="result error">❌ Cannot reach backend: ${error.message}</div>`;
                return;
            }
            
            // Test 2: Try to get calendar events
            try {
                resultsDiv.innerHTML += '<div class="result">📅 Testing calendar API (without auth)...</div>';
                
                const startDate = '2025-09-01';
                const endDate = '2025-09-30';
                
                const eventsResponse = await fetch(
                    `http://localhost:8000/api/calendar/events?start_date=${startDate}&end_date=${endDate}`
                );
                
                resultsDiv.innerHTML += `<div class="result">📊 Response status: ${eventsResponse.status}</div>`;
                
                if (eventsResponse.status === 401) {
                    resultsDiv.innerHTML += '<div class="result">🔐 API requires authentication (expected)</div>';
                } else if (eventsResponse.ok) {
                    const data = await eventsResponse.json();
                    resultsDiv.innerHTML += `<div class="result success">✅ Got ${data.length} events from API</div>`;
                    
                    // Analyze the events
                    const weekendEvents = data.filter(event => {
                        const eventDate = new Date(event.start_date);
                        const dayOfWeek = eventDate.getDay();
                        return dayOfWeek === 0 || dayOfWeek === 6; // Sunday or Saturday
                    });
                    
                    const saturdayHolidays = weekendEvents.filter(event => {
                        const eventDate = new Date(event.start_date);
                        return eventDate.getDay() === 6 && event.event_type?.toLowerCase() === 'holiday';
                    });
                    
                    const sundayHolidays = weekendEvents.filter(event => {
                        const eventDate = new Date(event.start_date);
                        return eventDate.getDay() === 0 && event.event_type?.toLowerCase() === 'holiday';
                    });
                    
                    resultsDiv.innerHTML += `<div class="result">
                        <h3>📊 Event Analysis:</h3>
                        <ul>
                            <li>Total events: ${data.length}</li>
                            <li>Weekend events (Sat/Sun): ${weekendEvents.length}</li>
                            <li>Saturday holidays: ${saturdayHolidays.length}</li>
                            <li>Sunday holidays: ${sundayHolidays.length}</li>
                        </ul>
                    </div>`;
                    
                    if (sundayHolidays.length > 0) {
                        resultsDiv.innerHTML += '<div class="result error">⚠️ Found Sunday holidays! Nepal calendar should only have Saturday holidays.</div>';
                    } else {
                        resultsDiv.innerHTML += '<div class="result success">✅ Correct! No Sunday holidays found (Nepal standard).</div>';
                    }
                    
                    // Show sample events
                    resultsDiv.innerHTML += `<div class="result">
                        <h3>📋 Sample Events:</h3>
                        <pre>${JSON.stringify(data.slice(0, 5), null, 2)}</pre>
                    </div>`;
                } else {
                    resultsDiv.innerHTML += `<div class="result error">❌ API call failed: ${eventsResponse.statusText}</div>`;
                }
            } catch (error) {
                resultsDiv.innerHTML += `<div class="result error">❌ Error testing calendar API: ${error.message}</div>`;
            }
        }
        
        // Auto-run the test
        testCalendarAPI();
    </script>
</body>
</html>